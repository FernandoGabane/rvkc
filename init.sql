CREATE DATABASE kart_club;
SET TIME ZONE 'America/Sao_Paulo';

\c kart_club;

CREATE TABLE ACCOUNT (
    ID VARCHAR(100) PRIMARY KEY,
    DOCUMENT VARCHAR(20) UNIQUE NOT NULL,
    NAME VARCHAR(100) NOT NULL,
    PHONE VARCHAR(20) NOT NULL,
    EMAIL VARCHAR(100) NOT NULL
);

CREATE TABLE ROLE (
    ID VARCHAR(100) PRIMARY KEY,
    NAME VARCHAR(50) UNIQUE NOT NULL -- ADMIN, COACH, DEFAULT
);

CREATE TABLE ACCOUNT_ROLE (
    ACCOUNT_ID VARCHAR(100) NOT NULL,
    ROLE_ID VARCHAR(100) NOT NULL,
    PRIMARY KEY (ACCOUNT_ID, ROLE_ID),
    FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ID),
    FOREIGN KEY (ROLE_ID) REFERENCES ROLE(ID)
);

CREATE TABLE CLUB (
    ID VARCHAR(100) PRIMARY KEY,
    NAME VARCHAR(100) NOT NULL,
    START_AT TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    END_AT TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    WEEKDAY VARCHAR(20) NOT NULL,
    ACCOUNT_ID VARCHAR(100) NOT NULL,
    SLOTS INTEGER NOT NULL,
    FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ID)
);

CREATE TABLE CONFIRMATION (
    ID VARCHAR(100) PRIMARY KEY,
    ACCOUNT_ID VARCHAR NOT NULL,
    CLUB_ID VARCHAR NOT NULL,
    STATUS VARCHAR(20) NOT NULL, -- "CONFIRMED", "UNCONFIRMED, PENDING"
    ACTION_AT TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ID),
    FOREIGN KEY (CLUB_ID) REFERENCES CLUB(ID)
);

INSERT INTO ROLE (ID, NAME) 
    VALUES
        ('ROLE_11111111-1111-1111-1111-111111111111', 'ADMIN'),
        ('ROLE_22222222-2222-2222-2222-222222222222', 'COACH'),
        ('ROLE_33333333-3333-3333-3333-333333333333', 'DEFAULT');

INSERT INTO ACCOUNT (ID, DOCUMENT, NAME, PHONE, EMAIL)
VALUES 
    ('ACCO_11111111-1111-1111-1111-111111111111', '11111111111', 'Admin Admin', '11999999999', 'admin@email.com'),
    ('ACCO_22222222-2222-2222-2222-222222222222', '22222222222', 'Coach Coach', '11999999999', 'coach@email.com'),
    ('ACCO_33333333-3333-3333-3333-333333333333', '33333333333', 'Default one', '11999999999', 'defaultone@email.com'),
    ('ACCO_44444444-4444-4444-4444-444444444444', '44444444444', 'Default two', '11999999999', 'defaultwo@email.com');

INSERT INTO ACCOUNT_ROLE (ACCOUNT_ID, ROLE_ID)
    VALUES
        ('ACCO_11111111-1111-1111-1111-111111111111', 'ROLE_11111111-1111-1111-1111-111111111111'),
        ('ACCO_22222222-2222-2222-2222-222222222222', 'ROLE_22222222-2222-2222-2222-222222222222'),
        ('ACCO_33333333-3333-3333-3333-333333333333', 'ROLE_33333333-3333-3333-3333-333333333333'),
        ('ACCO_44444444-4444-4444-4444-444444444444', 'ROLE_33333333-3333-3333-3333-333333333333');


INSERT INTO CLUB (ID, NAME, START_AT, END_AT, WEEKDAY, ACCOUNT_ID, SLOTS)
VALUES 
    ('CLUB_11111111-1111-1111-1111-111111111111','CLUB DAS 6', '2025-03-26 06:00:00.000 -0300', '2025-03-26 09:00:00.000 -0300', 'QUINTA-FEIRA', 'ACCO_22222222-2222-2222-2222-222222222222', 10),
    ('CLUB_22222222-2222-2222-2222-222222222222','CLUB DAS 6', '2025-03-26 15:00:00.000 -0300', '2025-03-26 18:00:00.000 -0300', 'SEXTA-FEIRA', 'ACCO_22222222-2222-2222-2222-222222222222', 10);


INSERT INTO CONFIRMATION (ID, ACCOUNT_ID, CLUB_ID, STATUS, ACTION_AT) VALUES
    ('CONF_11111111-1111-1111-1111-111111111111', 'ACCO_33333333-3333-3333-3333-333333333333', 'CLUB_11111111-1111-1111-1111-111111111111', 'CONFIRMED', '2025-03-25 18:00:00.000 -0300'),
    ('CONF_22222222-2222-2222-2222-222222222222', 'ACCO_44444444-4444-4444-4444-444444444444', 'CLUB_11111111-1111-1111-1111-111111111111', 'CONFIRMED', '2025-03-25 18:00:00.000 -0300');